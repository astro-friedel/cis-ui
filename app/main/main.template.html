<section>
  <div class="row">
    <!-- Component Palette -->
    <div class="col-sm-2">
      <h4>Models</h4>
      
      <table class="table table-condensed table-hover">
        <tr>
          <th>Model</th>
          <th width="15%" style="text-align:center;">Info</th>
          <th width="15%" style="text-align:center;">Add</th>
        </tr>
        <tr ng-repeat="model in getModelOptions(state.library)" tooltip-placement="right" uib-tooltip="{{ model.description }}">
          <td>{{ model.description }} ({{ model.label || model.name }})</td>
          <td style="text-align:center;">
            <button class="btn btn-xs btn-info" style="margin:0;" ng-click="showResults({ results: model, title: 'View Raw Model', isJson: true })">
              <i class="fa fa-fw fa-question-circle-o"></i> 
            </button>
          </td>
          <td style="text-align:center;">
            <button class="btn btn-xs btn-primary" style="margin:0;" ng-click="addNodeInstance(model)">
              <i class="fa fa-fw fa-plus"></i> 
            </button>
          </td>
        </tr>
      </table>
    </div>
    
    <!-- Graph Canvas -->
    <div ng-class="{ 'col-sm-10': !selectedItem, 'col-sm-8': selectedItem }">
      <div class="row">
        <div class="pull-right">
          
          <button class="btn btn-xs btn-default" ng-click="saveGraph()" tooltip-placement="left" uib-tooltip="Save existing graph">
            <i class="fa fa-fw fa-save" ng-class="{ 'faa-horizontal animated': graphIsChanged() }"></i>
          </button>
          
          <button class="btn btn-xs btn-default" ng-click="exportGraph()" tooltip-placement="left" uib-tooltip="View Raw JSON">
            <i class="fa fa-fw fa-code"></i>
          </button>
          
          <button class="btn btn-xs btn-default" style="color:orange" ng-click="addInport()" tooltip-placement="left" uib-tooltip="Add Graph Inport">
            <i class="fa fa-fw fa-sign-in"></i> Add Inport
          </button>
          
          <button class="btn btn-xs btn-default" style="color:green" ng-click="addOutport()" tooltip-placement="left" uib-tooltip="Add Graph Outport">
            <i class="fa fa-fw fa-sign-out"></i> Add Outport
          </button>
          
          <button type="submit" class="btn btn-xs btn-success" ng-disabled="running" ng-click="runSimulation()" tooltip-placement="left" uib-tooltip="Submit this graph to the Crops and Silico API">
            <i class="fa fa-fw" ng-class="{ 'fa-cogs': !running, 'fa-spinner fa-pulse': running }"></i> Submit
          </button>
          
          <button class="btn btn-xs btn-danger" ng-click="clearGraph()" tooltip-placement="left" uib-tooltip="Clear existing graph">
            <i class="fa fa-fw fa-trash"></i>
          </button>
        </div>
      </div>
      
      <div class="row border-cis" id="canvas-area">
        <the-graph-editor class="the-graph-light" graph="state.graph" library="state.library" loading="state.loading" width="state.width" height="state.height"></the-graph-editor>
         
        <div ng-if="loading" id="loading" style="position:absolute; top:10px; left:10px; background-color:white; padding:10px; border-radius:5px;">
          <i class="fa fa-fw fa-spinner fa-pulse"></i>
          <div id="loading-message">loading custom elements...</div>
        </div>
      </div>
    </div>
    
    <div class="col-sm-2" ng-if="selectedItem">
      <h4>{{ selectedItem.metadata.label || selectedItem.id }} Properties</h4>
      <form name="editForm" ng-submit="saveEdit()">
        
        <!-- ID Field -->
        <div class="form-group" >
            <label for="idField">ID <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The unique random id of this node"></i></sup></label>
            <input type="text" class="form-control" id="idField" name="idField" ng-model="selectedItem.id" ng-disabled="'true'" required />
        </div>
        
        
        <!-- Component Field -->
        <div class="form-group" >
          <label for="componentField">Component <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The unique random id of this node"></i></sup></label>
          
          <!-- FIXME: this should probably use <select> instead of <input> -->
          <input type="text" class="form-control" id="componentField" name="componentField" ng-model="selectedItem.component" ng-disabled="'true'" required />
          <ng-messages class="text-danger" for="modifySpec.componentField.$error" role="alert">
            <ng-message when="required">Component field is required</ng-message>
         </ng-messages>
        </div>
        
        <!-- Metadata Fields -->
        <div ng-if="selectedItem.metadata">
          
          <!-- Label Field -->
          <div class="form-group" >
            <label for="labelField">Label <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="A friendly label for this instance"></i></sup></label>
            <input type="text" class="form-control" id="labelField" name="labelField" ng-model="selectedItem.metadata.label" />
          </div>
          
          <!-- Metadata Field: X -->
          <div class="form-group">
            <label for="xField">X Position <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The horizontal position of this node on the canvas"></i></sup></label>
            <input type="number" class="form-control" id="xField" name="xField" ng-model="selectedItem.metadata.x" required />
            <ng-messages class="text-danger" for="editForm.xField.$error" role="alert">
              <ng-message when="required">X field is required</ng-message>
            </ng-messages>
          </div>
          
          <!-- Metadata Field: Y -->
          <div class="form-group" >
            <label for="yField">Y Position <sup><i class="fa fa-fw fa-question-circle" tooltip-placement="left" uib-tooltip="The vertical position of this node on the canvas"></i></sup></label>
            <input type="number" class="form-control" id="yField" name="yField" ng-model="selectedItem.metadata.y" required />
            <ng-messages class="text-danger" for="editForm.yField.$error" role="alert">
              <ng-message when="required">Y field is required</ng-message>
            </ng-messages>
          </div>
        </div>
        
        <!-- Save / Cancel -->
        <div class="pull-right">
          <button id="saveBtn" class="btn btn-success" type="submit" ng-disabled="editForm.$invalid"><i class="fa fa-fw fa-save"></i> Save</button>
          <button id="cancelBtn" class="btn btn-danger" type="button" ng-click="cancelEdit()"><i class="fa fa-fw fa-ban"></i> Cancel</button>
        </div>
      </form>
      
    </div>
  </div>
</section>
